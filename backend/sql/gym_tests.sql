CREATE TABLE public.roles (
	id varchar(255) NOT NULL,
	"name" varchar(255) NOT NULL,
	CONSTRAINT roles_pkey PRIMARY KEY (id),
	CONSTRAINT ukofx66keruapi6vyqpv6f2or37 UNIQUE (name)
);

CREATE TABLE public.users (
	id varchar(255) NOT NULL,
	email varchar(50) NULL,
	login varchar(255) NOT NULL,
	"name" varchar(255) NULL,
	"password" varchar(255) NOT NULL,
	CONSTRAINT uk6dotkott2kjsp8vw4d0m25fb7 UNIQUE (email),
	CONSTRAINT ukow0gan20590jrb00upg3va2fn UNIQUE (login),
	CONSTRAINT users_pkey PRIMARY KEY (id)
);

CREATE TABLE public.users_roles (
	user_id varchar(255) NOT NULL,
	role_id varchar(255) NOT NULL,
	CONSTRAINT users_roles_pkey PRIMARY KEY (user_id, role_id),
	CONSTRAINT fk2o0jvgh89lemvvo17cbqvdxaa FOREIGN KEY (user_id) REFERENCES public.users(id),
	CONSTRAINT fkj6m8fwv7oqv74fcehir1a9ffy FOREIGN KEY (role_id) REFERENCES public.roles(id)
);


-- SQL para parte de treinos

create table public.treino (
	id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
	name varchar(25) not null
);

alter table public.treino add user_id varchar(255) not null;
alter table public.treino add constraint fk_users_treino foreign key (user_id) references public.users(id);


create table public.un_medida (
	id 				UUID 			PRIMARY KEY DEFAULT gen_random_uuid(),
	name 			varchar(30)		not null,
	abv				varchar(10)		not null
);

create table public.exercicio (
	id 				UUID 			PRIMARY KEY DEFAULT gen_random_uuid(),
	name 			varchar(255) 	not null,
	active			boolean 		not null default true,
	treino_id 		UUID 			not null,
	inativated_at 	timestamp 		null default null,
	un_id 			UUID 			not null,
	created_at 		TIMESTAMP 		not null default CURRENT_TIMESTAMP,
	updated_at 		TIMESTAMP 		null default null,
	constraint fk_treino_exercicio foreign key (treino_id) references public.treino(id),
	constraint fk_un_medida_exercicio foreign key (un_id) references public.un_medida(id)
);

create table public.treinamento (
	id 				UUID 			PRIMARY KEY DEFAULT gen_random_uuid(),
	treino_id		UUID 			not null,
	started_at		TIMESTAMP 		not null default CURRENT_TIMESTAMP,
	finished_at 	TIMESTAMP 		null default null,
	constraint fk_treino_treinamento foreign key (treino_id) references public.treino(id)
);

create table public.serie (
	id 				UUID 			PRIMARY KEY DEFAULT gen_random_uuid(),
	treinamento_id	UUID			not null,
	exercicio_id 	UUID			not null,
	magnitude		numeric(5, 2)	not null,
	execucoes		int 			not null,
	created_at 		TIMESTAMP 		not null default CURRENT_TIMESTAMP,
	constraint fk_treinamento_serie foreign key (treinamento_id) references public.treinamento(id),
	constraint fk_exercicio_serie foreign key (exercicio_id) references public.exercicio(id)
);

drop table public.execucao;

-- ver tabelas criadas 
SELECT DISTINCT
	table_name
FROM 
    information_schema.columns
WHERE 
    table_schema = 'public';


-- add users to database
INSERT INTO public.users (id,email,login,"name","password") VALUES
	 ('6645ac83-adef-4a48-b26d-516a9bc4370b','eduardo@gmail.com','eduardo','Eduardo Fiorentin','$2a$10$JmHASUiV/oDiFfoL8p3L2uQ2Gb4mQWatK0aiXvrbjS587bcjtx6Y6'),
	 ('246cd543-ef60-4786-a4df-19a7cdcef66c','eduarda@gmail.com','eduarda','Eduarda Rampaneli','$2a$10$h5x258PV1o35ziMQrCXwzOl4k1aeUh8xTjLXQgqnDxKk132z527LG'),
	 ('f627c4b1-b982-4d3d-93af-55191fb6c7b3','manager@gmail.com','manager','Manager','$2a$10$zwfrRLZHehDAhkyhp.0nL.9zGyt2AtpEtQSKC0KSBz/QImypexDRi');

INSERT INTO public.roles (id,"name") VALUES
	 ('649a1a65-6182-4634-86a2-441548816f23','ADMIN'),
	 ('8662c1f7-84e9-42bf-a531-b73169246547','USER'),
	 ('3016a13b-a321-4ea8-81f8-cf3dcb234057','MANAGER');

INSERT INTO public.users_roles (user_id,role_id) VALUES
	 ('6645ac83-adef-4a48-b26d-516a9bc4370b','649a1a65-6182-4634-86a2-441548816f23'),
	 ('6645ac83-adef-4a48-b26d-516a9bc4370b','8662c1f7-84e9-42bf-a531-b73169246547'),
	 ('246cd543-ef60-4786-a4df-19a7cdcef66c','8662c1f7-84e9-42bf-a531-b73169246547'),
	 ('f627c4b1-b982-4d3d-93af-55191fb6c7b3','8662c1f7-84e9-42bf-a531-b73169246547'),
	 ('f627c4b1-b982-4d3d-93af-55191fb6c7b3','649a1a65-6182-4634-86a2-441548816f23'),
	 ('f627c4b1-b982-4d3d-93af-55191fb6c7b3','3016a13b-a321-4ea8-81f8-cf3dcb234057');




select * from users;

select * from roles;

select * from users_roles;


-- exemplo de treinamento - generated by Gemini


-- 1. Cria a unidade de medida padrão (kg)
INSERT INTO public.un_medida (id, name, abv) 
VALUES 
	('c1c1c1c1-1111-1111-1111-c1c1c1c1c1c1', 'Quilogramas', 'kg');

-- 2. Cria dois treinos associados ao usuário "Eduardo"
INSERT INTO public.treino (id, name, user_id) 
VALUES 
	('aaaaaaaa-1111-1111-1111-aaaaaaaaaaaa', 'A - Peito e Tríceps', '6645ac83-adef-4a48-b26d-516a9bc4370b'),
	('bbbbbbbb-2222-2222-2222-bbbbbbbbbbbb', 'B - Pernas', '6645ac83-adef-4a48-b26d-516a9bc4370b');

-- 3. Cadastra 4 exercícios para cada treino
INSERT INTO public.exercicio (id, name, treino_id, un_id) 
VALUES
	('a0000001-1111-1111-1111-aaaaaaaaaaaa', 'Supino Reto', 'aaaaaaaa-1111-1111-1111-aaaaaaaaaaaa', 'c1c1c1c1-1111-1111-1111-c1c1c1c1c1c1'),
	('a0000002-1111-1111-1111-aaaaaaaaaaaa', 'Crucifixo Inclinado', 'aaaaaaaa-1111-1111-1111-aaaaaaaaaaaa', 'c1c1c1c1-1111-1111-1111-c1c1c1c1c1c1'),
	('a0000003-1111-1111-1111-aaaaaaaaaaaa', 'Tríceps Pulley', 'aaaaaaaa-1111-1111-1111-aaaaaaaaaaaa', 'c1c1c1c1-1111-1111-1111-c1c1c1c1c1c1'),
	('a0000004-1111-1111-1111-aaaaaaaaaaaa', 'Tríceps Testa', 'aaaaaaaa-1111-1111-1111-aaaaaaaaaaaa', 'c1c1c1c1-1111-1111-1111-c1c1c1c1c1c1'),
	('b0000001-2222-2222-2222-bbbbbbbbbbbb', 'Agachamento Livre', 'bbbbbbbb-2222-2222-2222-bbbbbbbbbbbb', 'c1c1c1c1-1111-1111-1111-c1c1c1c1c1c1'),
	('b0000002-2222-2222-2222-bbbbbbbbbbbb', 'Leg Press 45', 'bbbbbbbb-2222-2222-2222-bbbbbbbbbbbb', 'c1c1c1c1-1111-1111-1111-c1c1c1c1c1c1'),
	('b0000003-2222-2222-2222-bbbbbbbbbbbb', 'Cadeira Extensora', 'bbbbbbbb-2222-2222-2222-bbbbbbbbbbbb', 'c1c1c1c1-1111-1111-1111-c1c1c1c1c1c1'),
	('b0000004-2222-2222-2222-bbbbbbbbbbbb', 'Cadeira Flexora', 'bbbbbbbb-2222-2222-2222-bbbbbbbbbbbb', 'c1c1c1c1-1111-1111-1111-c1c1c1c1c1c1');

-- 4. Inicia um Treinamento (uma sessão de academia) para cada Treino
INSERT INTO public.treinamento (id, treino_id, started_at, finished_at) 
VALUES
	-- Treinamento A ocorreu a 2 horas atrás
	('11111111-aaaa-aaaa-aaaa-111111111111', 'aaaaaaaa-1111-1111-1111-aaaaaaaaaaaa', CURRENT_TIMESTAMP - interval '2 hours', CURRENT_TIMESTAMP - interval '1 hour'),
	-- Treinamento B ocorreu a 1 dia atrás
	('22222222-bbbb-bbbb-bbbb-222222222222', 'bbbbbbbb-2222-2222-2222-bbbbbbbbbbbb', CURRENT_TIMESTAMP - interval '1 day', CURRENT_TIMESTAMP - interval '23 hours');

-- 5. Lança as Execuções (3 séries com pesos crescentes para cada exercício)
-- O ID da execução será gerado automaticamente pelo gen_random_uuid()
INSERT INTO public.serie (treinamento_id, exercicio_id, magnitude, execucoes) 
VALUES
	('11111111-aaaa-aaaa-aaaa-111111111111', 'a0000001-1111-1111-1111-aaaaaaaaaaaa', 20.00, 10), -- Supino Reto: Série 1
	('11111111-aaaa-aaaa-aaaa-111111111111', 'a0000001-1111-1111-1111-aaaaaaaaaaaa', 25.00, 10), -- Supino Reto: Série 2
	('11111111-aaaa-aaaa-aaaa-111111111111', 'a0000001-1111-1111-1111-aaaaaaaaaaaa', 30.00, 10), -- Supino Reto: Série 3
	('11111111-aaaa-aaaa-aaaa-111111111111', 'a0000002-1111-1111-1111-aaaaaaaaaaaa', 12.00, 10), -- Crucifixo Inclinado
	('11111111-aaaa-aaaa-aaaa-111111111111', 'a0000002-1111-1111-1111-aaaaaaaaaaaa', 14.00, 10), 
	('11111111-aaaa-aaaa-aaaa-111111111111', 'a0000002-1111-1111-1111-aaaaaaaaaaaa', 16.00, 10), 
	('11111111-aaaa-aaaa-aaaa-111111111111', 'a0000003-1111-1111-1111-aaaaaaaaaaaa', 15.00, 10), -- Tríceps Pulley
	('11111111-aaaa-aaaa-aaaa-111111111111', 'a0000003-1111-1111-1111-aaaaaaaaaaaa', 20.00, 10), 
	('11111111-aaaa-aaaa-aaaa-111111111111', 'a0000003-1111-1111-1111-aaaaaaaaaaaa', 25.00, 10), 
	('11111111-aaaa-aaaa-aaaa-111111111111', 'a0000004-1111-1111-1111-aaaaaaaaaaaa', 10.00, 10), -- Tríceps Testa
	('11111111-aaaa-aaaa-aaaa-111111111111', 'a0000004-1111-1111-1111-aaaaaaaaaaaa', 12.00, 10), 
	('11111111-aaaa-aaaa-aaaa-111111111111', 'a0000004-1111-1111-1111-aaaaaaaaaaaa', 14.00, 10),
	('22222222-bbbb-bbbb-bbbb-222222222222', 'b0000001-2222-2222-2222-bbbbbbbbbbbb', 40.00, 10), -- Agachamento Livre
	('22222222-bbbb-bbbb-bbbb-222222222222', 'b0000001-2222-2222-2222-bbbbbbbbbbbb', 50.00, 10), 
	('22222222-bbbb-bbbb-bbbb-222222222222', 'b0000001-2222-2222-2222-bbbbbbbbbbbb', 60.00, 10), 
	('22222222-bbbb-bbbb-bbbb-222222222222', 'b0000002-2222-2222-2222-bbbbbbbbbbbb', 120.00, 10), -- Leg Press 45
	('22222222-bbbb-bbbb-bbbb-222222222222', 'b0000002-2222-2222-2222-bbbbbbbbbbbb', 140.00, 10), 
	('22222222-bbbb-bbbb-bbbb-222222222222', 'b0000002-2222-2222-2222-bbbbbbbbbbbb', 160.00, 10), 
	('22222222-bbbb-bbbb-bbbb-222222222222', 'b0000003-2222-2222-2222-bbbbbbbbbbbb', 30.00, 10), -- Cadeira Extensora
	('22222222-bbbb-bbbb-bbbb-222222222222', 'b0000003-2222-2222-2222-bbbbbbbbbbbb', 35.00, 10), 
	('22222222-bbbb-bbbb-bbbb-222222222222', 'b0000003-2222-2222-2222-bbbbbbbbbbbb', 40.00, 10), 
	('22222222-bbbb-bbbb-bbbb-222222222222', 'b0000004-2222-2222-2222-bbbbbbbbbbbb', 30.00, 10), -- Cadeira Flexora
	('22222222-bbbb-bbbb-bbbb-222222222222', 'b0000004-2222-2222-2222-bbbbbbbbbbbb', 35.00, 10), 
	('22222222-bbbb-bbbb-bbbb-222222222222', 'b0000004-2222-2222-2222-bbbbbbbbbbbb', 40.00, 10);



-- exemplos de consultas 

-- Citar treinamentos de um usuário 
SELECT 
    t.id AS treino_id, 
    t.name AS nome_do_treino
FROM public.treino t
WHERE t.user_id = '6645ac83-adef-4a48-b26d-516a9bc4370b' -- ID do usuário Eduardo
ORDER BY t.name;

-- Exercicios pertencentes a um treino
SELECT 
    e.id AS exercicio_id, 
    e.name AS exercicio_nome, 
    um.abv AS unidade
FROM public.exercicio e
JOIN public.un_medida um ON e.un_id = um.id
WHERE e.treino_id = 'aaaaaaaa-1111-1111-1111-aaaaaaaaaaaa' -- ID do Treino A
  AND e.active = true -- Traz apenas exercícios que não foram inativados
ORDER BY e.created_at ASC;


-- listar histórico de treinos
SELECT 
    tr.id AS sessao_id,
    t.name AS nome_do_treino,
    tr.started_at AS inicio,
    tr.finished_at AS fim,
    -- Calcula a duração do treino em minutos
    ROUND(CAST(EXTRACT(EPOCH FROM (tr.finished_at - tr.started_at)) / 60 AS NUMERIC), 2) AS duracao_minutos
FROM public.treinamento tr
JOIN public.treino t ON tr.treino_id = t.id
WHERE t.user_id = '6645ac83-adef-4a48-b26d-516a9bc4370b'
ORDER BY tr.started_at DESC;


-- relatório de um treinamento 
SELECT 
    e.name AS exercicio,
    s.execucoes AS repeticoes,
    s.magnitude AS carga,
    um.abv AS unidade,
    TO_CHAR(s.created_at, 'HH24:MI:SS') AS horario_da_serie
FROM public.treinamento tr
JOIN public.serie s ON s.treinamento_id = tr.id
JOIN public.exercicio e ON s.exercicio_id = e.id
JOIN public.un_medida um ON e.un_id = um.id
WHERE tr.id = '11111111-aaaa-aaaa-aaaa-111111111111' -- ID de uma sessão específica
ORDER BY e.created_at, s.created_at;

--Supino Reto	10	30.00	kg	13:38:24
--Supino Reto	10	25.00	kg	13:38:24
--Supino Reto	10	20.00	kg	13:38:24

-- representado como: 
-- (30Kg)10 (25Kg)10 (20Kg)10

--Supino Reto	10	30.00	kg	13:38:24
--Supino Reto	10	30.00	kg	13:38:24
--Supino Reto	10	30.00	kg	13:38:24
-- representado como: 
-- (30Kg)10 10 10

--Supino Reto	10	25.00	kg	13:38:24
--Supino Reto	10	30.00	kg	13:38:24
--Supino Reto	10	30.00	kg	13:38:24
-- representado como: 
-- (25Kg)10 10 (30Kg) 10

